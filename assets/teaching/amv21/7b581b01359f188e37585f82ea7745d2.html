<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>AMV 2021-22, Michaelmas: Topic 5 Solutions</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="https://samfearn.github.io/latex.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script type="text/x-mathjax-config">
  	MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "ams"} } });
  	// I need to wait until MathJax has finished before running the numbering script
  	MathJax.Hub.Register.StartupHook("End",function(){doNumbering()});
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">AMV 2021-22, Michaelmas: Topic 5 Solutions</h1>
</header>
<p><span> </span></p>
<div class="problem">
<p>For which values of <span class="math inline">\((x,y)\)</span> are the following continuous:<br />
</p>
<ul>
<li><p><span class="math inline">\(\qquad {x/(x^2+y^2+1)}\)</span>,</p>
<div class="solution">
<p>Use the theorem that if <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span> are continuous at a point then so are <span class="math inline">\(f+g\)</span>, <span class="math inline">\(fg\)</span> and <span class="math inline">\(f/g\)</span> if <span class="math inline">\(g\)</span> does not vanish there. Taking <span class="math inline">\(f=x\)</span> and <span class="math inline">\(g=y\)</span> all the functions can be built up by repeated applications of this result, so all the functions will be continuous whenever their denominators are non-zero so this function is continuous everywhere since <span class="math inline">\(x^2+y^2+1&gt;0\)</span>,</p>
</div></li>
<li><p><span class="math inline">\(\qquad {x/(x^2+y^2)}\)</span>,</p>
<div class="solution">
<p>everywhere except the origin,</p>
</div></li>
<li><p><span class="math inline">\(\qquad {(x+y)/(x-y)}\)</span>,</p>
<div class="solution">
<p>everywhere except the line <span class="math inline">\(y=x\)</span>,</p>
</div></li>
<li><p><span class="math inline">\(\qquad {x^3/( y-x^2)}\)</span>?</p>
<div class="solution">
<p>everywhere except the parabola <span class="math inline">\(y=x^2\)</span>.</p>
</div></li>
</ul>
</div>
<div class="problem">
<p>Which of the following sets are open:<br />
</p>
<ul>
<li><p><span class="math inline">\(\qquad \{(x,y,z):x&gt;0\}\)</span>,</p>
<div class="solution">
<p>An open set has to contain an open ball centred on each of its points, so this is open because for any point we can construct a sphere centred on that point and lying entirely within the set, even points arbitrarily close to the plane <span class="math inline">\(x=0\)</span>. To make this really precise, suppose <span class="math inline">\({\underline{a}}=(a_1,a_2,a_3)\)</span> is in the set. Then <span class="math inline">\(a_1&gt;0\)</span> and if we take <span class="math inline">\(\delta=a_1/2 &gt;0\)</span>, then <span class="math inline">\(B_{\delta}({\underline{a}})\)</span> is entirely in the set.</p>
<p>To see this, consider <span class="math inline">\((x,y,z) = \underline{x} \in B_{\delta}({\underline{a}})\)</span>. Since <span class="math inline">\(\underline{x}\in B_{\delta}({\underline{a}})\)</span>, <span class="math inline">\(a_1 - \delta &lt; x &lt; a_1 + \delta\)</span>, so <span class="math inline">\(\frac{a_1}{2}&lt;x\)</span>. But then <span class="math inline">\(x = x- \frac{a_1}{2} +\frac{a_1}{2} = x - \frac{a_1}{2} + \delta &gt; 0\)</span>. So <span class="math inline">\(\underline{x}\)</span> is in the set.</p>
<p>Since this works for all points <span class="math inline">\({\underline{a}}\)</span> in the set, the set is open.</p>
</div></li>
<li><p><span class="math inline">\(\qquad \{(x,y,z):y\ge 0\}\)</span>,</p>
<div class="solution">
<p>this is not open because it contains points for which <span class="math inline">\(y=0\)</span>. Let <span class="math inline">\(\underline{x}\)</span> be such a point, and consider a sphere of radius <span class="math inline">\(\delta&gt;0\)</span> around <span class="math inline">\(\underline{x}\)</span>. Then <span class="math inline">\(\underline{x}- \delta \underline{e}_2 = (x,-\delta,z) \in B_{\delta}({\underline{x}})\)</span>, and this point does not lie in the original set.</p>
</div></li>
<li><p><span class="math inline">\(\qquad \{(x,y,z):1&gt;{(x^2+y^2)/ z}\}\)</span>,</p>
<div class="solution">
<p><span class="math inline">\(1&gt;(x^2+y^2)/ z\)</span> implies <span class="math inline">\(z&gt;x^2+y^2\)</span> or <span class="math inline">\(z&lt;0\)</span>, and this is open because for any point we can construct a sphere centred on that point and lying entirely within the set, even points arbitrarily close to the paraboloid <span class="math inline">\(z=x^2+y^2\)</span> or to <span class="math inline">\(z=0\)</span>. (Beware: you might forget that points with <span class="math inline">\(z&lt;0\)</span> are also in the set!)</p>
</div></li>
<li><p><span class="math inline">\(\qquad \{(x,y,z):1\ge {(x^2+y^2)/ z}\}\)</span>?</p>
<div class="solution">
<p>this is not open because it contains points for which <span class="math inline">\(z=x^2+y^2\)</span>, and any sphere with such a point as its centre contains points outside the set.</p>
</div></li>
</ul>
</div>
<div class="problem">
<p>Prove that an open ball, as defined in lectures, is an open set.</p>
</div>
<div class="solution">
<p>Let <span class="math inline">\(B_{\delta}({\underline{a}})\)</span> be the open ball centred at <span class="math inline">\({\underline{a}}\)</span> with radius <span class="math inline">\(\delta\)</span>, and let <span class="math inline">\({\underline{x}}\)</span> be any point in <span class="math inline">\(B_{\delta}({\underline{a}})\)</span>. We need to show that there’s a <span class="math inline">\(\delta&#39;\)</span> such that <span class="math inline">\(B_{\delta&#39;}({\underline{x}})\subset B_{\delta}({\underline{a}})\)</span>. Since <span class="math inline">\({\underline{x}}\in B_{\delta}({\underline{a}})\)</span>, <span class="math inline">\(|{\underline{x}}-{\underline{a}}|&lt;\delta\)</span>. Let <span class="math inline">\(\delta&#39;=\delta-|{\underline{x}}-{\underline{a}}|\)</span>. By the remark just made, <span class="math inline">\(\delta&#39;&gt;0\)</span>, and if <span class="math inline">\({\underline{x}}&#39;\)</span> is any point in <span class="math inline">\(B_{\delta&#39;}({\underline{x}})\)</span> then <span class="math inline">\(|{\underline{x}}&#39;-{\underline{x}}|&lt;\delta&#39;\)</span> which implies <span class="math inline">\(|{\underline{x}}&#39;-{\underline{a}}|=|{\underline{x}}&#39;-{\underline{x}}+{\underline{x}}-{\underline{a}}|\le
|{\underline{x}}&#39;-{\underline{x}}|+|{\underline{x}}-{\underline{a}}|\)</span> (by the triangle inequality). Hence <span class="math inline">\(|{\underline{x}}&#39;-{\underline{a}}|
&lt; \delta&#39;+|{\underline{x}}-{\underline{a}}|=\delta\)</span>, and so <span class="math inline">\({\underline{x}}&#39;\in B_{\delta}({\underline{a}})\)</span>, which is what we needed to prove. (This all becomes much clearer if you draw a picture – basically we are just setting <span class="math inline">\(\delta&#39;\)</span> equal to the distance from <span class="math inline">\({\underline{x}}\)</span> to the edge of <span class="math inline">\(B_{\delta}({\underline{a}})\)</span>.)</p>
</div>
<div class="problem">
<p>Prove that the intersection of two open sets, as defined in lectures, is another open set. (Note that the empty set is an open set: since it contains no points, the statement that every point in it sits inside an open ball which is also in the set is <em>vacuously</em> true.) What about the intersection of a finite number of open sets? And what about the intersection of an <em>infinite</em> number of open sets?</p>
</div>
<div class="solution">
<p>Let the two open sets be <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span>, and put <span class="math inline">\(S=S_1\cap S_2\)</span>. If <span class="math inline">\(S=\emptyset\)</span> then there’s nothing more to be done since <span class="math inline">\(\emptyset\)</span> is open. If <span class="math inline">\(S\neq \emptyset\)</span> then let <span class="math inline">\({\underline{a}}\)</span> be any point in <span class="math inline">\(S\)</span>. Then <span class="math inline">\({\underline{a}}\in
S_1\)</span>, and since <span class="math inline">\(S_1\)</span> is open we can find a value of <span class="math inline">\(\delta_1&gt;0\)</span> such that <span class="math inline">\(B_{\delta_1}({\underline{a}})\subset S_1\)</span>; and similarly <span class="math inline">\({\underline{a}}\in
S_2\)</span>, and we can find a value of <span class="math inline">\(\delta_2&gt;0\)</span> such that <span class="math inline">\(B_{\delta_2}({\underline{a}})\subset S_2\)</span>. Now set <span class="math inline">\(\delta=\min(\delta_1,\delta_2)\)</span>; then <span class="math inline">\(B_\delta({\underline{a}})\)</span> is a subset of both <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span>, which means that it is a subset of <span class="math inline">\(S\)</span>. Since this works for <em>any</em> point <span class="math inline">\({\underline{a}}\in S\)</span>, this proves that <span class="math inline">\(S\)</span> is open.<br />
For the intersection <span class="math inline">\(S\)</span> of a finite number of open sets <span class="math inline">\(S_1\)</span>, <span class="math inline">\(S_2\)</span>, … <span class="math inline">\(S_n\)</span>, the argument is much the same: either <span class="math inline">\(S\)</span> is the empty set, or else for any point <span class="math inline">\({\underline{a}}\)</span> in <span class="math inline">\(S\)</span> we can take <span class="math inline">\(\delta=\min(\delta_1,\delta_2, \dots \delta_n)\)</span> and show that <span class="math inline">\(B_{\delta}({\underline{a}})\)</span> is in <span class="math inline">\(S\)</span>.<br />
However this doesn’t necessarily work for an infinite intersection, as <span class="math inline">\(\min(\delta_1,\delta_2,\dots)\)</span> might be zero if there are infinitely many <span class="math inline">\(\delta_i\)</span>s. For example, if for <span class="math inline">\(n=1,2,\dots\)</span> <span class="math inline">\(S_n\)</span> is the open ball centred on the origin with radius <span class="math inline">\(1/n\)</span>, then the interection of all the <span class="math inline">\(S_n\)</span>s is the set containing the single point <span class="math inline">\({\underline{0}}\)</span>, which is <em>not</em> an open set.</p>
</div>
<div class="problem">
<p>Exam question June 2014 (Section A):</p>
<ul>
<li><p>Give the definition of the open ball <span class="math inline">\(B_{\delta}(\mathbf{a})\)</span> with centre <span class="math inline">\(\mathbf{a}\in\mathbb{R}^n\)</span> and radius <span class="math inline">\(\delta&gt;0\)</span>, and define what it means for a subset <span class="math inline">\(S\)</span> of <span class="math inline">\(\mathbb{R}^n\)</span> to be open.</p></li>
<li><p>Which of the following subsets of <span class="math inline">\(\mathbb{R}^2\)</span> are open? In each case, justify your answer in terms of the definition you gave in part (a).</p>
<ul>
<li><p><span class="math inline">\(S_1=\{(x,y): x&gt;2\}\)</span> ,</p></li>
<li><p><span class="math inline">\(S_2=\{(x,y): x&gt;2,y=2\}\)</span> ,</p></li>
<li><p><span class="math inline">\(S_3=\{(x,y): x&gt;2,y&gt;2\}\)</span> .</p></li>
</ul></li>
</ul>
</div>
<div class="solution">
<ul>
<li><p><span class="math inline">\(B_{\delta}(\mathbf{a})=\{{\underline{x}}\in\mathbb{R}^n:|{\underline{x}}-{\underline{a}}|&lt;\delta\}\)</span>; a subset <span class="math inline">\(S\)</span> of <span class="math inline">\(\mathbb{R}^n\)</span> is <em>open</em> if for each point <span class="math inline">\({\underline{a}}\in S\)</span> there is an open ball <span class="math inline">\(B_{\delta}({\underline{a}})\)</span> which is also in <span class="math inline">\(S\)</span> (where <span class="math inline">\(\delta\)</span> might depend on <span class="math inline">\({\underline{a}}\)</span>).</p></li>
<li><p>open, not open, open. (NB: ‘not open’ is not the same as ‘closed’!) In each case some justification should be given. (Sketch for part (i): if <span class="math inline">\(\underline{a}=(a_1,a_2)\in S_1\)</span> then <span class="math inline">\(a_1-2&gt;0\)</span>. Let <span class="math inline">\(\delta=a_1-2&gt;0\)</span>, and consider <span class="math inline">\(\underline{x}=(x,y) \in B_{\delta}(\underline{a})\)</span>. We want to show <span class="math inline">\(\underline{x}\in S_1\)</span>, which means we need to show <span class="math inline">\(x&gt; 2\)</span>. We have <span class="math inline">\(x - 2 = x - a_1 + a_1 -2 = x - a_1 + \delta\)</span>. But <span class="math inline">\(|x - a_1| &lt; \delta \implies -\delta &lt; x-a_1 &lt; \delta\)</span>, so <span class="math inline">\(x - 2 = x-a_1 + \delta &gt; 0\)</span>, and hence <span class="math inline">\(B_{\delta}(\underline{a}) \subset S_1\)</span>.)</p></li>
</ul>
</div>
<div class="problem">
<p>Exam question (last part) June 2014 (Section B): Determine the points of <span class="math inline">\(\mathbb{R}^2\)</span> at which the function <span class="math inline">\(f(x,y) = 
|xy+x+y+1|\)</span> is<br />
(a) continuously differentiable; (b) differentiable. (Hint: first factorise <span class="math inline">\(f\)</span>.)</p>
</div>
<div class="solution">
<p><span class="math inline">\(f(x,y)=|xy+x+y+1|=|(x+1)(y+1)|\)</span> so <span class="math inline">\(f(x,y)=(x+1)(y+1)\)</span> for <span class="math inline">\((x+1)(y+1)&gt;0\)</span> and <span class="math inline">\(f(x,y)=-(x+1)(y+1)\)</span> for <span class="math inline">\((x+1)(y+1)&lt;0\)</span>. Hence away from the lines <span class="math inline">\(x=-1\)</span> or <span class="math inline">\(y=-1\)</span>, <span class="math inline">\(f\)</span> is a polynomial in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and therefore has continuous partial derivatives, and hence is both continuously differentiable, and, by the theorem from lectures, differentiable in this region. It remains to consider the two lines <span class="math inline">\(x=-1\)</span> and <span class="math inline">\(y=-1\)</span>.<br />
On the line <span class="math inline">\(x=-1\)</span>, we have <span class="math display">\[\frac{\partial f}{\partial x}=
\lim_{h\rightarrow 0} \frac{f(-1+h,y)-f(-1,y)}{h}
=
\lim_{h\rightarrow 0} \frac{|h(y+1)|}{h}
=
\lim_{h\rightarrow 0} \frac{|h|}{h}\,|y+1|\,.\]</span> Hence for <span class="math inline">\(y\neq -1\)</span> the limit doesn’t exist as <span class="math inline">\(|h|/h=\pm 1\)</span>; while for <span class="math inline">\(y=-1\)</span> the limit exists and is zero. Also on the line <span class="math inline">\(x=-1\)</span> we have <span class="math display">\[\frac{\partial f}{\partial x}=
\lim_{h\rightarrow 0} \frac{f(-1,y+h)-f(-1,y)}{h} =0\,.\]</span> Similarly on the line <span class="math inline">\(y=-1\)</span>, <span class="math inline">\(\frac{\partial f}{\partial x}=0\)</span> while <span class="math inline">\(\frac{\partial f}{\partial y}\)</span> does not exist except at <span class="math inline">\(x=-1\)</span>.<br />
Since one or other partial derivative does not exist on the lines <span class="math inline">\(x=-1\)</span> and <span class="math inline">\(y=-1\)</span> away from <span class="math inline">\((x,y)=(-1,-1)\)</span>, <span class="math inline">\(f\)</span> is neither continuously differentiable nor differentiable on these lines away from <span class="math inline">\((-1,-1)\)</span>; it is also not continuously differentiable at <span class="math inline">\((-1,-1)\)</span> since the partial derivatives do not exist on these lines away from that point.<br />
Finally we must ask whether <span class="math inline">\(f\)</span> is differentiable at <span class="math inline">\({\underline{a}}=(-1,-1)\)</span>. Both partials of <span class="math inline">\(f\)</span> are zero at that point, so <em>if</em> <span class="math inline">\(f\)</span> were differentiable there, the remainder term would have to be <span class="math inline">\(R({\underline{h}})=f({\underline{a}}+{\underline{h}})-f({\underline{a}})\)</span>. Consider <span class="math inline">\({\underline{h}}=(h_1,h_2)\)</span>: then <span class="math display">\[\frac{R({\underline{h}})}{|{\underline{h}}|}=
\frac{f(-1+h_1,-1+h_2)-f(-1,-1)}{|{\underline{h}}|}=\frac{|h_1|h_2|}{|{\underline{h}}|}\,.\]</span> Since <span class="math inline">\(|h_1|\le |{\underline{h}}|\)</span> and <span class="math inline">\(|h_2|\le |{\underline{h}}|\)</span>, we have <span class="math inline">\(R({\underline{h}})/|{\underline{h}}|\le |{\underline{h}}|\)</span> and since <span class="math inline">\(|{\underline{h}}|\to 0\)</span> as <span class="math inline">\({\underline{h}}\to 0\)</span>, the same must be true of <span class="math inline">\(R({\underline{h}})/|{\underline{h}}|\)</span>. Hence <span class="math inline">\(f\)</span> <em>is</em> differentiable at <span class="math inline">\((-1,1)\)</span>.<br />
Conclusion: (a) <span class="math inline">\(f\)</span> is continuously differentiable at all points in <span class="math inline">\(\mathbb{R}^2\)</span> away from the lines <span class="math inline">\(x=-1\)</span> or <span class="math inline">\(y=-1\)</span>; (b) <span class="math inline">\(f\)</span> is differentiable at all points in (a) and also at <span class="math inline">\((-1,-1)\)</span>.</p>
</div>
<div class="problem">
<p>Determine the points of <span class="math inline">\(\mathbb{R}^2\)</span> at which the function <span class="math inline">\(f(x,y) = |x^2 - 
y^2|\)</span> is<br />
(a) continuously differentiable; (b) differentiable.</p>
</div>
<div class="solution">
<p><span class="math inline">\(f(x,y) = |x^2 - y^2|\)</span> is <span class="math inline">\(x^2 - y^2\)</span> for <span class="math inline">\(x^2 - y^2=(x-y)(x+y)&gt;0\)</span> and <span class="math inline">\(y^2-x^2\)</span> for <span class="math inline">\(x^2 - y^2=(x-y)(x+y)&lt;0\)</span>. For the first case <span class="math inline">\((x-y)(x+y)&gt;0\)</span> for <span class="math inline">\(x-y&gt;0\)</span> and <span class="math inline">\(x+y&gt;0\)</span> or <span class="math inline">\(x-y&lt;0\)</span> and <span class="math inline">\(x+y&lt;0\)</span>, call this part of <span class="math inline">\(\mathbb{R}^2\)</span> region 1. For the second case <span class="math inline">\((x-y)(x+y)&lt;0\)</span> for <span class="math inline">\(x-y&gt;0\)</span> and <span class="math inline">\(x+y&lt;0\)</span> or <span class="math inline">\(x-y&lt;0\)</span> and <span class="math inline">\(x+y&gt;0\)</span>, call this part of <span class="math inline">\(\mathbb{R}^2\)</span> region 2. Within both regions the function is a polynomial in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and so has continuous partial derivatives, hence the function is continuously differentiable there. In neighbourhoods of points on the line <span class="math inline">\(y=\pm x\)</span> the function is no longer a polynomial and we have to be more careful so use the definition of the partial derivative: for <span class="math inline">\(y=x=a\)</span> <span class="math display">\[{\partial f\over\partial x}=
\lim_{h\rightarrow 0} {|(a+h)^2-a^2|\over h}=\lim_{h\rightarrow 0} 
{|2ah+h^2|\over h}\]</span> If <span class="math inline">\(a\neq 0\)</span> we can neglect the <span class="math inline">\(h^2\)</span> term in comparison to the <span class="math inline">\(ah\)</span> piece so we get <span class="math display">\[\lim_{h\rightarrow 0} 
{|2ah|\over h}=\lim_{h\rightarrow 0} 
{|2a|\,|h|\over h}\]</span> which does not exist because <span class="math inline">\(|h|\over h\)</span> is <span class="math inline">\(\pm 1\)</span> depending on the sign of <span class="math inline">\(h\)</span>. However if <span class="math inline">\(a=0\)</span> then the limit is <span class="math display">\[\lim_{h\rightarrow 0} 
{|h^2|\over h}=0\,.\]</span> Similar arguments show that <span class="math inline">\({\partial f\over\partial y}\)</span> also does not exist on this line except at the origin, and also that neither partial derivative exists on the line <span class="math inline">\(y=-x\)</span>, except at the origin. Since the p.d.s do not exist on the lines <span class="math inline">\(y=\pm x\)</span> away from <span class="math inline">\({\bf 0}\)</span> the function cannot be differentiable there. It might be differentiable at <span class="math inline">\({\bf 0}\)</span> but cannot be continuously differentiable there, because the p.d.s are not continuous at <span class="math inline">\({\bf 0}\)</span> (since they do not exist on the lines). Now investigate the differentiablity of <span class="math inline">\(f\)</span> at the origin. Consider <span class="math display">\[{R\over |{\bf h}|}={f({\bf h})-f({\bf 0})-{\bf h}\cdot\nabla f\over |{\bf h}|}={|h_1^2-h_2^2|\over |{\bf h}|}\]</span> Now <span class="math display">\[{|h_1^2-h_2^2|\over |{\bf h}|}\leq{h_1^2\over |{\bf h}|}
+{h_2^2\over |{\bf h}|}\leq |{\bf h}|+|{\bf h}|\]</span> we have that <span class="math inline">\(|{R/ |{\bf h}|}|&lt;\epsilon\)</span> whenever <span class="math inline">\(|{\bf h}|&lt;\delta\)</span> by taking <span class="math inline">\(\delta=\epsilon/2\)</span> so <span class="math inline">\(\lim_{{\bf h}\rightarrow 0}
{R/ |{\bf h}|}=0\)</span> and <span class="math inline">\(f\)</span> is differentiable at the origin.</p>
</div>
<div class="problem">
<p>Define <span class="math inline">\(f:\mathbb{R}^2\rightarrow\mathbb{R}\)</span> by <span class="math inline">\(f({\bf 0})=0\)</span> whilst for <span class="math inline">\({\bf x}\,\neq {\bf 0}\)</span>: <span class="math display">\[f({\bf x}\,)={x^3\over x^2+y^2}\,.\]</span> Calculate the partial derivatives of <span class="math inline">\(f\)</span> with respect to <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> at <span class="math inline">\({\bf x}\,={\bf 0}\)</span> <span><em>using their definitions as limits</em></span>. Defining <span class="math inline">\(R({\bf h})\)</span> at the origin by <span class="math inline">\(R({\bf h})=f({\bf h})-f({\bf
0})-{\bf h}\cdot\nabla f\)</span> as usual, show that <span class="math inline">\(R({\bf h})/|{\bf h}|\)</span> does not tend to zero as <span class="math inline">\({\bf h}\)</span> tends to <span class="math inline">\(\bf 0\)</span>, so that <span class="math inline">\(f\)</span> is not differentiable at the origin.<br />
On the line through the origin, <span class="math inline">\({\bf x}\,={\bf b}t\)</span>, (with <span class="math inline">\({\bf b}\)</span> a constant vector), <span class="math inline">\(f\)</span> becomes a function of the single variable <span class="math inline">\(t\)</span>, <span class="math inline">\(f({\bf b}t)\)</span>. Write <span class="math inline">\({\bf b}={\bf e_1}b_1+{\bf e_2}b_2\)</span> and use this to write <span class="math inline">\(f({\bf b}t)\)</span> explicitly as a function of <span class="math inline">\(t\)</span>. Show that this function is differentiable at the origin, i.e. <span class="math inline">\(df/dt\)</span> exists at <span class="math inline">\(t=0\)</span> despite <span class="math inline">\(f({\bf x}\,)\)</span> not being differentiable at <span class="math inline">\(\bf 0\)</span>.</p>
</div>
<div class="solution">
<p><span class="math display">\[{\partial f\over\partial x}=\lim_{h\rightarrow 0}{f(h{\bf e_1})-f({\bf 0})\over h}
=\lim_{h\rightarrow 0}{h-0\over h}=1\]</span> and <span class="math display">\[{\partial f\over\partial y}=\lim_{h\rightarrow 0}{f(h{\bf e_2})-f({\bf 0})\over h}
=\lim_{h\rightarrow 0}{0-0\over h}=0\,.\]</span> With the standard definition of <span class="math inline">\(R\)</span>, <span class="math display">\[{R\over |{\bf h}|}={f({\bf h})-f({\bf 0})-
{\bf h}\cdot\nabla f\over |{\bf h}|}
={h_1^3\over (h_1^2+h_2^2)^{3/2}}-0-
{h_1\over (h_1^2+h_2^2)^{1/2}}={-h_1 h_2^2 \over (h_1^2+h_2^2)^{3/2}}\]</span> now consider how this behaves as the origin is approached along the line <span class="math inline">\(h_2=mh_1\)</span> then <span class="math display">\[{R\over |{\bf h}|}={-m^2h_1^3
\over (1+m^2)^{3/2} h_1^3}={-m^2
\over (1+m^2)^{3/2} }\]</span> which remains constant as the origin is approached. Since this is not zero <span class="math inline">\(f\)</span> cannot be differentiable at the origin. <span class="math display">\[f({\bf b}t)={(b_1t)^3\over (b_1t)^2+(b_2t)^2}=t{b_1^3\over b_1^2+b_2^2}\]</span> which is <span class="math inline">\(t\)</span> multiplied by a constant (this also holds at <span class="math inline">\(\bf 0\)</span> since <span class="math inline">\(f\)</span> is defined to vanish there), and so is differentiable at the origin.</p>
</div>
<div class="problem">
<p>If <span class="math inline">\(y = 1 + xy^5\)</span> show that <span class="math inline">\(y\)</span> may be written in the form <span class="math inline">\(y = f(x)\)</span> in a neighbourhood of <span class="math inline">\((0,1)\)</span> and find the gradient of the graph of <span class="math inline">\(f\)</span> at the point <span class="math inline">\((0,1)\)</span>.</p>
</div>
<div class="solution">
<p><span class="math inline">\(y = 1 + xy^5\)</span> is a level curve of <span class="math inline">\(H=y-1 -xy^5\)</span> with <span class="math inline">\(H=0\)</span> and passes through <span class="math inline">\((0,1)\)</span>. <span class="math inline">\(H\)</span> is polynomial in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and so has continuous derivatives and is therefore differentiable. The implicit function theorem then implies that <span class="math inline">\(y\)</span> may be written in the form <span class="math inline">\(y = f(x)\)</span> in a neighbourhood of <span class="math inline">\((0,1)\)</span> if <span class="math inline">\({\partial H\over \partial y}\neq 0\)</span> there. Now <span class="math inline">\({\partial H\over \partial y}=1-5xy^4=1\)</span> at <span class="math inline">\((0,1)\)</span> so the condition is satisfied. The implicit function theorem also gives the gradient of the function as <span class="math display">\[g&#39;(0)=-{\partial H\over \partial x}/{\partial H\over \partial y}\,,\]</span> now <span class="math inline">\({\partial H\over \partial x}=-y^5=-1\)</span> at <span class="math inline">\((0,1)\)</span> so <span class="math inline">\(g&#39;(0)=1\)</span>.</p>
</div>
<div class="problem">
<p>Show that the equation <span class="math inline">\(xy^3 - y^2 -3x^2 + 1 = 0\)</span> can be written in the form <span class="math inline">\(y = f(x)\)</span> in a neighbourhood of the point <span class="math inline">\((0,1)\)</span>, and in the form <span class="math inline">\(y = g(x)\)</span> in a neighbourhood of the point <span class="math inline">\((0,-1)\)</span>. Is it true that <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(g(x)\)</span> are of the same form? What are the critical values of the curve <span class="math inline">\(H(x,y) = xy^3 - y^2 -3x^2 + 1\)</span>, and what are the regular values of this curve?</p>
</div>
<div class="solution">
<p><span class="math inline">\(xy^3 - y^2 -3x^2 + 1 = 0\)</span> is a level curve of <span class="math inline">\(H=xy^3 - y^2 -3x^2 + 1\)</span> with <span class="math inline">\(H=0\)</span> and passes through <span class="math inline">\((0,\pm 1)\)</span>. <span class="math inline">\(H\)</span> is polynomial in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and so has continuous derivatives and is therefore differentiable. <span class="math inline">\({\partial H\over
\partial y}=3xy^2 - 2y\)</span>, so at <span class="math inline">\((0,\pm 1)\)</span>, <span class="math inline">\({\partial H\over \partial y}\neq
0\)</span>. The implicit function theorem then implies that <span class="math inline">\(y\)</span> may be written in the form <span class="math inline">\(y = f(x)\)</span> in a neighbourhood of the point <span class="math inline">\((0,1)\)</span>, and in the form <span class="math inline">\(y = g(x)\)</span> in a neighbourhood of the point <span class="math inline">\((0,-1)\)</span>. Note that at <span class="math inline">\(x=0\)</span> we must have <span class="math inline">\(f(0)=1\)</span> but <span class="math inline">\(g(0)=-1\)</span> so <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(g(x)\)</span> cannot be of the same form. In fact solving <span class="math inline">\(xy^3 - y^2 + 1 = 0\)</span> for <span class="math inline">\(y\)</span> gives three solutions, since it is a cubic equation and one passes through <span class="math inline">\((0,1)\)</span> another through <span class="math inline">\((0,- 1)\)</span>.</p>
<p>To find the critical values of <span class="math inline">\(H(x,y)\)</span>, we must consider values of <span class="math inline">\(c\)</span> for which the curve <span class="math inline">\(H(x,y)=c\)</span> contains critical points, i.e. points where <span class="math inline">\(\underline{\nabla\mkern-2mu}\mkern 3mu H = 0\)</span>. We have <span class="math inline">\(\frac{\partial H}{\partial x} = y^3 -6x\)</span>, so <span class="math inline">\(\underline{\nabla\mkern-2mu}\mkern 3mu H = 0\)</span> if we have <span class="math inline">\(y^3 -6x=0\)</span> and <span class="math inline">\(3xy^2 - 2y = 0\)</span>. If <span class="math inline">\(y\ne 0\)</span>, we can rearrange these equations in terms of <span class="math inline">\(x\)</span> and set them equal to give <span class="math inline">\(\frac{y^3}{6} = \frac{2}{3y}\)</span>, with real solutions <span class="math inline">\(y= \pm \sqrt{2}\)</span>. Substituting this back to find <span class="math inline">\(x\)</span>, we have <span class="math inline">\(\underline{\nabla\mkern-2mu}\mkern 3mu H = 0\)</span> at the points <span class="math inline">\((\pm \frac{\sqrt{2}}{3},\pm\sqrt{2})\)</span>, so these are critical points of <span class="math inline">\(H(x,y)\)</span>. If <span class="math inline">\(y=0\)</span>, then we have <span class="math inline">\(\underline{\nabla\mkern-2mu}\mkern 3mu H = 0\)</span> if <span class="math inline">\(x=0\)</span>, so there is also a critical point at the origin. Critical values of <span class="math inline">\(H(x,y)\)</span> are values <span class="math inline">\(c\)</span> where <span class="math inline">\(H(x,y)=c\)</span> contains critical points of <span class="math inline">\(H\)</span>, so we need to find which values of <span class="math inline">\(c\)</span> the critical points correspond to. Since <span class="math inline">\(H(\pm \frac{\sqrt{2}}{3},\pm\sqrt{2}) = -\frac{1}{3}\)</span>, we have one critical value at <span class="math inline">\(c=-\frac{1}{3}\)</span>, and since <span class="math inline">\(H(\underline{0})=1\)</span>, we have another critical value at <span class="math inline">\(c=1\)</span>. The regular values are therefore <span class="math inline">\(\mathbb{R}-\{-\frac{1}{3},1\}\)</span>.</p>
</div>
<div class="problem">
<p>Determine whether or not the equation <span class="math inline">\(x^2 + y + \sin (xy) =0\)</span> can be written in the form <span class="math inline">\(y = f(x)\)</span> or in the form <span class="math inline">\(x = g(y)\)</span> in some small open disc about the origin for some suitable continuously differentiable functions <span class="math inline">\(f,g\)</span>.</p>
</div>
<div class="solution">
<p><span class="math inline">\(x^2 + y + \sin (xy) =0\)</span> is a level curve of <span class="math inline">\(H=x^2 + y + \sin (xy)\)</span> with <span class="math inline">\(H=0\)</span> and passes through the origin. <span class="math inline">\(H\)</span> has continuous partial derivatives and so is differentiable. <span class="math inline">\({\partial H\over \partial y}=1+x \cos (xy)\)</span> is <span class="math inline">\(1\)</span> at the origin and <span class="math inline">\({\partial H\over \partial x}=2x +y\cos (xy)\)</span> vanishes at the origin, so by the implicit function theorem <span class="math inline">\(y\)</span> may be written in the form <span class="math inline">\(y = f(x)\)</span> in a neighbourhood of the origin with differentiable <span class="math inline">\(f\)</span>, but <span class="math inline">\(x\)</span> cannot be written in the form <span class="math inline">\(x = g(y)\)</span>.</p>
</div>
<div class="problem">
<p>Exam question May 2015 (Section B, lightly edited):<br />
Let <span class="math inline">\(f: \mathbb{R}^2\to\mathbb{R}\)</span> be the scalar function <span class="math inline">\(f(x,y)=e^{xy}-x+y\)</span>.<br />
</p>
<ul>
<li><p>Find the vector equations of the tangent and normal lines to the curve <span class="math inline">\(f(x,y)=0\)</span> at the points <span class="math inline">\((1,0)\)</span> and <span class="math inline">\((0,-1)\)</span>.</p></li>
<li><p>Use the implicit function theorem for functions of two variables to determine whether or not the curve <span class="math inline">\(f(x,y)=2\)</span> can be written in the form <span class="math inline">\(y=g(x)\)</span> for some differentiable function <span class="math inline">\(g(x)\)</span> in the neighbourhoods of the points  (i) <span class="math inline">\((0,1)\)</span> ;   (ii) <span class="math inline">\((-1,0)\)</span>.<br />
Determine also whether the curve can be written as <span class="math inline">\(x=h(y)\)</span> for some differentiable function <span class="math inline">\(h(y)\)</span>, in the neighbourhoods of the same two points.</p></li>
<li><p>Does the function <span class="math inline">\(f(x,y)\)</span> have any critical points? Justify your answer. (You can quote without proof that <span class="math inline">\(|xe^{-x^2}|&lt;1\)</span> for all <span class="math inline">\(x\in\mathbb{R}\)</span>.)</p></li>
</ul>
</div>
<div class="solution">
<ul>
<li><p>We have <span class="math display">\[\nabla f=\frac{\partial f}{\partial x}\mathbf{e}_1+
\frac{\partial f}{\partial y}\mathbf{e}_1~,\qquad
\frac{\partial f}{\partial x}=ye^{xy}-1~,\quad
\frac{\partial f}{\partial y}=xe^{xy}+1~,\]</span> and so <span class="math inline">\(\nabla f(1,0)=-\mathbf{e}_1+2\mathbf{e}_2\)</span> and <span class="math inline">\(\nabla f(0,-1)=-2\mathbf{e}_1+\mathbf{e}_2\)</span>.<br />
Hence the equations of the normal lines at <span class="math inline">\((1,0)\)</span> and <span class="math inline">\((0,-1)\)</span> can be written as <span class="math display">\[\mathbf{x}=\mathbf{e}_1+\lambda(-\mathbf{e}_1+2\mathbf{e}_2)=
(1-\lambda)\mathbf{e}_1+2\lambda\mathbf{e}_2\]</span> and <span class="math display">\[\mathbf{x}=-\mathbf{e}_2+\lambda(-2\mathbf{e}_1+\mathbf{e}_2)=
-2\lambda\mathbf{e}_1+(\lambda-1)\mathbf{e}_2\]</span> respectively. Vectors perpendicular to <span class="math inline">\(\nabla f\)</span> at <span class="math inline">\((1,0)\)</span> and <span class="math inline">\((0,-1)\)</span> are (for example) <span class="math inline">\(2\mathbf{e}_1+\mathbf{e}_2\)</span> and <span class="math inline">\(\mathbf{e}_1+2\mathbf{e}_2\)</span>, so the two tangent lines can be written as <span class="math display">\[\mathbf{x}=\mathbf{e}_1+\mu(2\mathbf{e}_1+\mathbf{e}_2)=
(1+2\mu)\mathbf{e}_1+\mu\mathbf{e}_2\]</span> and <span class="math display">\[\mathbf{x}=-\mathbf{e}_2+\mu(\mathbf{e}_1+2\mathbf{e}_2)=
\mu\mathbf{e}_1+(2\mu-1)\mathbf{e}_2\,.\]</span></p></li>
<li><p>Reminder of implicit function theorem (not needed for the problem sheet, though it <em>did</em> feature in the exam question: if <span class="math inline">\(f(x,y): U\to\mathbb{R}\)</span> is differentiable on <span class="math inline">\(U\)</span> with <span class="math inline">\(U\)</span> open in <span class="math inline">\(\mathbb{R}^2\)</span>, and if <span class="math inline">\((x_0,y_0)\)</span> is a point on the level curve <span class="math inline">\(f(x,y)=c\)</span> at which <span class="math inline">\(\frac{\partial f}{\partial y}\neq 0\)</span>, then a differentiable function <span class="math inline">\(g(x)\)</span> exists in a neighbourhood of <span class="math inline">\(x=x_0\)</span> such that (I) <span class="math inline">\(f(x,g(x))=c\)</span> and (II) <span class="math inline">\(\frac{d g}{dx}=-\frac{\partial f}{\partial x}
\frac{\partial f}{\partial y}\)</span>, with <span class="math inline">\(g(x_0)=y_0\)</span>. Here, <span class="math inline">\(f\)</span> is everywhere differentiable and we just need to check the partials. At <span class="math inline">\((0,1)\)</span>, <span class="math inline">\(\frac{\partial f}{\partial y}=1\)</span> so the curve <em>can</em> be written as <span class="math inline">\(y=g(x)\)</span>; but at <span class="math inline">\((-1,0)\)</span>, <span class="math inline">\(\frac{\partial f}{\partial y}=0\)</span> so the curve <em>cannot</em> be written as <span class="math inline">\(y=g(x)\)</span>. For the final part, swap <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> in the implicit function theorem and check the partial <span class="math inline">\(x\)</span> derivatives: at <span class="math inline">\((0,1)\)</span>, <span class="math inline">\(\frac{\partial f}{\partial x}=0\)</span> so the curve <em>cannot</em> be written as <span class="math inline">\(x=h(y)\)</span>; and at <span class="math inline">\((-1,0)\)</span>, <span class="math inline">\(\frac{\partial f}{\partial x}=-1\)</span> so the curve <em>can</em> be written as <span class="math inline">\(x=h(y)\)</span>.</p></li>
<li><p>For a critical point we need <span class="math inline">\(\nabla f=\mathbf 0\)</span>, so <span class="math inline">\(ye^{xy}=1\)</span> and <span class="math inline">\(xe^{xy}=-1\)</span> must hold. Adding implies <span class="math inline">\((x+y)e^{xy}=0\)</span>, so <span class="math inline">\(y=-x\)</span>. Then <span class="math inline">\(xe^{-x^2}=-1\)</span> is required, but this contradicts the inequality given in the question. Hence <span class="math inline">\(f\)</span> has no critical points.</p></li>
</ul>
</div>
<div class="problem">
<p>Part of Exam Question May 2017 (Section B):</p>
<ul>
<li><p>Consider the function <span class="math display">\[f(x,y) = (3x + y)e^{3xy}.\]</span> Determine whether or not the curve <span class="math inline">\(f(x,y)=c\)</span> can be written in the form <span class="math inline">\(y=g(x)\)</span>, and if not, state clearly the points <span class="math inline">\((x_0,y_0)\)</span> and corresponding values of <span class="math inline">\(c\)</span> where problems occur. You may assume that <span class="math inline">\(f\)</span> is differentiable on <span class="math inline">\(\mathbb{R}^2\)</span>.</p></li>
<li><p>Using <span class="math inline">\(f(x,y)\)</span> as given in the previous part, determine whether or not the curve <span class="math inline">\((f(x,y)=c)\)</span> can be written in the form <span class="math inline">\(x=y(h)\)</span>, and if not, state clearly the points <span class="math inline">\((x_0,y_0)\)</span> where problems occur.</p></li>
<li><p>Using <span class="math inline">\(f(x,y)\)</span> as in the previous parts of this question, are there any points where the curve <span class="math inline">\(f(x,y)=c\)</span> can neither be written as <span class="math inline">\(y=g(x)\)</span>, nor as <span class="math inline">\(x=h(y)\)</span>?</p></li>
</ul>
</div>
<div class="solution">
<ul>
<li><p>By the implicit function theorem, if <span class="math inline">\((x_0,y_0)\)</span> is a point on the curve <span class="math inline">\(f(x,y)=c\)</span> at which <span class="math inline">\(\frac{\partial f}{\partial y}\ne 0\)</span>, then the curve <span class="math inline">\(f(x,y)=c\)</span> can be written in the form <span class="math inline">\(y=g(x)\)</span> in a neighbourhood of the point <span class="math inline">\((x_0,y_0)\)</span>. We have <span class="math display">\[\begin{aligned}
				\frac{\partial f}{\partial y} &amp;= \frac{\partial}{\partial y}((3x + y)e^{3xy})\\
				&amp;= e^{3xy} + (3x + y)3xe^{3xy}\\
				&amp;= (1 + 9x^2 + 3xy)e^{3xy}\\
				\text{so} \qquad \frac{\partial f}{\partial y} = 0 &amp;\iff 1 + 9x^2 + 3xy = 0\\
				\text{If } x \ne 0 \quad \implies \quad y &amp;= -\frac{(1+9x^2)}{3x} = -\left(3x + \frac{1}{3x}\right) \qquad (\dagger).
			\end{aligned}\]</span> So problems occur at point <span class="math inline">\((x_0,y_0)\)</span> with <span class="math inline">\(y_0 = -(3x_0 + 1/3x_0)\)</span>.</p>
<p>Now we need to find which values of <span class="math inline">\(c\)</span> these problems occur at, so we evaluate <span class="math display">\[\begin{aligned}
				c = f(x_0,y_0) &amp;= \left(3x_0 + \left( - \left( 3x_0 + \frac{1}{3x_0} \right) \right) \right)e^{3x_0(-(3x_0 + 1/3x_0))} \\
				&amp;= -\frac{1}{3x_0} e^{-9x_0^2 - 1},
			\end{aligned}\]</span> which for <span class="math inline">\(x \in \mathbb{R}-\{0\}\)</span> can give any value for <span class="math inline">\(c\)</span> except <span class="math inline">\(c=0\)</span>.</p></li>
<li><p>Similarly, for <span class="math inline">\(x=h(y)\)</span> need <span class="math inline">\(\frac{\partial f}{\partial x} \ne 0\)</span>. Fast way is to notice that <span class="math inline">\(f\)</span> is symmetric under the interchange <span class="math inline">\(3x \leftrightarrow y\)</span>, which gives the result. The long way is <span class="math display">\[\begin{aligned}
				\frac{\partial f}{\partial x} &amp;= \frac{\partial}{\partial x}((3x + y)e^{3xy})\\
				&amp;= 3e^{3xy} + (3x + y)3ye^{3xy}\\
				&amp;= (3 + 3y^2 + 9xy)e^{3xy}\\
				\text{so} \qquad \frac{\partial f}{\partial y} = 0 &amp;\iff 3 + 3y^2 + 9xy = 0\\
				\text{If } y \ne 0 \quad \implies \quad x &amp;= -\frac{(3+3y^2)}{9y} = -\frac{1}{3}\left(y + \frac{1}{y}\right) \qquad (\ddagger).
			\end{aligned}\]</span> So problems occur at point <span class="math inline">\((x_0,y_0)\)</span> with <span class="math inline">\(x_0 = -\frac{1}{3}\left(y_0 + \frac{1}{y_0}\right)\)</span>.</p></li>
<li><p>Points where we can neither write <span class="math inline">\(y=g(x)\)</span> nor <span class="math inline">\(x=h(y)\)</span> are the <em>critical points</em>, where <span class="math inline">\(\underline{\nabla\mkern-2mu}\mkern 3mu {}f=\underline{0}\)</span>. At these points, both <span class="math inline">\((\dagger)\)</span> and <span class="math inline">\((\ddagger)\)</span> are satisfied simultaneously. If we substitute <span class="math inline">\(3x_0 = -\left(y_0 + \frac{1}{y_0}\right)\)</span> into <span class="math inline">\((\dagger)\)</span>, remembering that this requires <span class="math inline">\(y_0 \ne 0\)</span>, gives <span class="math display">\[\begin{aligned}
				y_0 &amp;= \left( y_0 + \frac{1}{y_0} \right) + 1/\left( y_0 + \frac{1}{y_0} \right) \\
				\implies 0 &amp;= \frac{1}{y_0} + 1/\left( y_0 + \frac{1}{y_0} \right) \\
				\implies 0 &amp;= \left( y_0 + \frac{1}{y_0} \right) + y_0 \\
				\implies 0 &amp;= 2y_0^2 + 1.
			\end{aligned}\]</span> Since <span class="math inline">\(2y_0^2 + 1&gt;0\)</span>, no points simultaneously satisfy <span class="math inline">\((\dagger)\)</span> and <span class="math inline">\((\ddagger)\)</span>, and hence no points exist where <span class="math inline">\(f\)</span> can neither be written as <span class="math inline">\(y=g(x)\)</span> nor as <span class="math inline">\(x=h(y)\)</span>.</p></li>
</ul>
</div>
<script>
function doNumbering() {
	// The syntax to read the structured data from the yaml is horrible, template literals fix the problem but probably aren't widely supported enough. Escaping line breaks is browser dependant. I don't know if there's a better way?
	// Note that the data from the yaml file is manipulated into an array, and then parsed back into strings later, but I didn't want to deal with the pandoc templating syntax longer than necessary.
	var supportedEnvsArrayString = ' .definition;;; .theorem;;; .lemma;;; .example;;; .proposition;;; .remark;;; .corollary';
	var supportedEnvsArray = supportedEnvsArrayString.split("|||");
	supportedEnvsArray = supportedEnvsArray.map(inner => inner.split(";;;"));
	var numberWithin = '1';
	var counterOffset = '';
	var subcounterOffset = '';
	var problemCounter = '37';
	const partLabels = 'abcdefghijklmnopqrstuvwxyz'.split('');
	
	// counterOffset may be negative, and by default if specified on the command line this gets string concatenated with the default given in the yaml config and this then causes a problem. Can be fixed by removing the default in the config file and converting to an int, but this causes a NaN error if no value is suplied on the command line, so if NaN set to 0.
	counterOffset = parseInt(counterOffset);
	if (isNaN(counterOffset)) {
		counterOffset = 0;
	}
	
	subcounterOffset = parseInt(subcounterOffset);
	if (isNaN(subcounterOffset)) {
		subcounterOffset = 0;
	}
	
	problemCounter = parseInt(problemCounter);
	if (isNaN(problemCounter)) {
		problemCounter = 1;
	}
	
	function sanitiseSelector(selector) {
		// tex labels often have colons in which need escaping. There may be other escaping needed here. Unfortunately neither encodeURI nor encodeURIComponent do what I need, so use regex to do the escaping manually.
		var sanitised = selector.replace(/\:/g,"\\\:");
		sanitised = sanitised.replace(/(^[\d])/,"\\3$1 ");
		sanitised = sanitised.replace(/\//g,"\\\/");
		return sanitised
	}
	
	function labelLinks() {
		var refs = document.querySelectorAll("a[data-reference-type=ref]")
		for (ref of refs) {
			// Escape colons (or other) from the link title.
			var ref_label = sanitiseSelector(ref.getAttribute("data-reference"));
			// Hopefully ref is a reference to a div or a section, which should have the associated id. If so, we just need the data-number from the relevant DOM item.
			var ref_to = document.querySelector("#"+ref_label);
			if (ref_to !== null) {
				var ref_number = ref_to.getAttribute("data-number");
			} else {
				// If ref is being used for an equation, then we need to try to parse the mathjax divs. This is fragile, but try to find the span which corresponds to the equation number we need.
				try {
					var mathjax_ref = "#mjx-eqn-"+ref_label;
					ref_to = document.querySelector(mathjax_ref);
					// Since this is a ref, we don't want the parens to be returned, so find the equation number and strip the parens.
					var ref_number = ref_to.querySelector(".mjx-char").innerHTML.replace(/[()]/g,"");
					ref.setAttribute("href",mathjax_ref);
				}
				// If we can't find a place to link to, just indicate a missing link.
				catch (err){
					var ref_number = "???"
				}
			}
			ref.innerHTML = ref_number;
		};
	}
	
	function numberEnvs() {
		for (var levelSpec = 0; levelSpec <= numberWithin; levelSpec++) {
			var reqLevels = document.querySelectorAll(".level"+levelSpec);
			for (var level of reqLevels) {
				levelCount = level.getAttribute("data-number");
				levelCount = String(parseFloat(levelCount)+(counterOffset));
				levelCount = levelCount+(("."+subcounterOffset).repeat(numberWithin-levelSpec));
				for (var counter of supportedEnvsArray) {
					var envCount = 1;
					var envs = level.querySelectorAll(counter.join(", "));
					for (var env of envs) {
						env.setAttribute("data-number",levelCount+"."+envCount);
						envCount += 1;
					}
				}
			}
		}
	}
	
	function numberFigs() {
		// Figures should either be in a figure environment, or a table with image class imageTable thanks to the tableCaps filter.
		figs = document.querySelectorAll("figure, .imageTable");
		var fig_no = 1
		for (var fig of figs) {
			var cap
			// For figures, we want to move the id to the figure, and set the data-number on both the figure and the figcaption
			if (fig.nodeName == "FIGURE") {
				cap = fig.querySelector("figcaption");
				var img = fig.querySelector("img, embed")
				if (img) {
					var img_id = img.getAttribute("id");
					fig.setAttribute("id",img_id);
					img.removeAttribute("id");
				}
			// for tables (which must be .imageTable due to the querySelector above), we want to set the data-number on the table and the caption
			} else if (fig.nodeName == "TABLE") {
				cap = fig.querySelector("caption");
			}
			cap.setAttribute("data-number",fig_no);
			fig.setAttribute("data-number",fig_no);
			fig_no += 1;
		}
	}
	
	function numberGlobals() {
		// This function numbers any environments that just use a global counter, such as a problem number on a problems sheet, where there are no sections to number with respect to.
		probsols = document.querySelectorAll(".problem, .solution");
		var prob_no = problemCounter;
		var partNo = 0;
		for (var probsol of probsols) {
			if (probsol.className == "problem"){
				prob_no +=1;
				partNo = 0;
				probsol.setAttribute("data-number",prob_no);
			}
			else {
				if (probsol.parentNode.nodeName == "LI") {
					var partLabel = partLabels[partNo];
					probsol.setAttribute("data-number",prob_no.toString()+partLabel);
					partNo +=1;
				}
				else{
					probsol.setAttribute("data-number",prob_no);
				}
			}
			
		}
		// sols = document.querySelectorAll(".solution");
// 		var sol_no = problemCounter;
// 		for (var sol of sols) {
// 			sol.setAttribute("data-number",sol_no);
// 			sol_no +=1
// 		}
	}
	
	// labelLinks() should occur last, so that the data-numbers have been correctly set first.
	numberEnvs();
	numberFigs();
	numberGlobals();
	labelLinks();
}
</script><script>
	var imageDir = './Images/'
	imgs = document.querySelectorAll("img");
	for (var img of imgs) {
		imgsrc = img.getAttribute("src");
		img.setAttribute("src",imageDir.concat(imgsrc));
	}
</script></body>
</html>
